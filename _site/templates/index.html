{% extends "base.html" %} {% block body %} {% include "hero.html" %}

<section class="section">
  <div class="container">
    <div class="content">
      <div class="columns is-centered">
        <div class="column is-half">
          <h2>Abstract</h2>
          <p>{{ abstract | safe }}</p>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="content">
    <div class="columns is-centered">
      <div class="column is-two-thirds">
        <h2>Demo</h2>
        <div id="sketch-app">
          <div id="sketch-pane">
            <h3 class="title is-5">Input</h3>

            <div id="controls" class="mt-3 field is-grouped is-grouped-multiline">
              <!-- Mode -->
              <div class="control is-flex is-align-items-center">
                <label class="radio is-size-7 mr-3">
                  <input
                    type="radio"
                    name="gen-mode"
                    id="mode-generation"
                    value="generation"
                    checked
                  />
                  Generation
                </label>
                <label class="radio is-size-7">
                  <input type="radio" name="gen-mode" id="mode-completion" value="completion" />
                  Completion
                </label>
              </div>

              <!-- Model -->
              <div class="control is-flex is-align-items-center">
                <label for="model-select" class="mr-2 is-size-7">Model:</label>
                <div class="select is-small">
                  <select id="model-select" name="model-select">
                    {% for m in models %}
                    <option value="{{ m.tag }}" {% if loop.first %}selected{% endif %}>
                      {{ m.tag }}
                    </option>
                    {% endfor %}
                  </select>
                </div>
              </div>

              <!-- Class -->
              <div class="control is-flex is-align-items-center">
                <label for="example-class" class="mr-2 is-size-7">Class:</label>
                <div class="select is-small">
                  <select id="example-class" name="example-class"></select>
                </div>
              </div>

              <!-- Buttons -->
              <div class="control">
                <button id="clear" class="button is-small is-danger" type="button">Clear</button>
                <button
                  id="generate"
                  class="button is-small is-primary"
                  type="button"
                  onclick="updateSVG()"
                >
                  Generate
                </button>
              </div>
            </div>

            <div id="canvas-container" class="box is-hidden"></div>
          </div>

          <div id="svg-pane">
            <h3 class="title is-5 has-text-centered">Output</h3>
            <div id="svg-output" class="box has-background-light">
              (generate something to see SVG)
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="content">
    <div class="columns is-centered">
      <div class="column is-two-thirds">
        <h2>Examples</h2>

        <div id="examples">
          <div class="tabs is-centered is-toggle is-toggle-rounded is-small">
            <ul id="example-tabs">
              {% for group in examples %}
              <li
                class="{% if loop.first %}is-active{% endif %}"
                data-target="gallery-{{ group.id }}"
              >
                <a>
                  <span>{{ group.id }}</span>
                  <span class="tag is-light ml-2">{{ group.images|length }}</span>
                </a>
              </li>
              {% endfor %}
            </ul>
          </div>

          {% for group in examples %}
          <div
            id="gallery-{{ group.id }}"
            class="gallery-group {% if not loop.first %}is-hidden{% endif %}"
          >
            <div class="columns is-multiline is-mobile">
              {% for img in group.images %}
              <div
                class="column is-half-mobile is-one-third-tablet is-one-quarter-desktop is-one-fifth-widescreen"
              >
                <div
                  class="gallery-card box p-2"
                  data-img-src="{{ url_for('static', filename=img) }}"
                >
                  <figure class="image is-square">
                    <img
                      src="{{ url_for('static', filename=img) }}"
                      alt="Example {{ loop.index }} in {{ group.id }}"
                    />
                  </figure>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
</section>

<section class="section">
  <div class="container">
    <div class="columns is-centered is-variable is-6 has-text-centered">
      <div class="column is-one-third">
        <h2 class="title is-3">Representation</h2>
        <img
          id="rep"
          src="https://lh3.googleusercontent.com/d/1hHpIjWtsx4aTy6gQXQYWrAtz5bEtWsnf?authuser=0"
          alt="representation"
        />
        <div class="content has-text-justified">{{ representation | safe }}</div>
      </div>
      <div class="column is-one-third">
        <h2 class="title is-3">System</h2>
        <img
          id="network"
          src="https://lh3.googleusercontent.com/d/1-RrvCI_VJreORa0Qe17lrG91wOAqxwYC?authuser=0"
          alt="model"
        />
        <div class="content has-text-justified">{{ model | safe }}</div>
      </div>
      <div class="column is-one-third">
        <h2 class="title is-3">Training</h2>
        <img
          id="pipe"
          src="https://lh3.googleusercontent.com/d/1morMfQw_t8rDO7dYLg6uxr1IYZTsNnrj?authuser=0"
          alt="training"
        />
        <div class="content has-text-justified">{{ training | safe }}</div>
      </div>
    </div>
  </div>
</section>

<footer class="footer">
  <div class="content has-text-centered">
    <p>
      &copy; 2025 {{ title }} Â·
      <a href="{{ code_url }}" target="_blank" rel="noopener">Source Code</a>
    </p>
  </div>
</footer>

<script src="{{ url_for('static', filename='js/demo.js') }}"></script>

<script>
  window.MODELS = {{ models | tojson }};
  const modelSel = document.getElementById("model-select");
  const classSel = document.getElementById("example-class");

  function updateClasses() {
    const tag = modelSel.value;
    if (tag === "medium") {
      bins = 32;
    } else {
      bins = 16;
    }
    console.log("Bins set to:", bins);
    tokenizer = new DeltaPenPositionTokenizer(bins, width, height);

    const model = window.MODELS.find(m => m.tag === tag);
    const labels = model ? model.labels : [];
    classSel.innerHTML = "";
    labels.forEach((name, idx) => {
      const opt = document.createElement("option");
      opt.value = name;
      opt.dataset.index = idx;
      opt.textContent = name;
      classSel.appendChild(opt);
    });
  }

  modelSel.addEventListener("change", updateClasses);
  updateClasses();
</script>

<script>
  // Tabs
  (function () {
    const tabs = document.querySelectorAll("#example-tabs li");
    const groups = document.querySelectorAll(".gallery-group");
    tabs.forEach((tab) => {
      tab.addEventListener("click", () => {
        tabs.forEach((t) => t.classList.remove("is-active"));
        tab.classList.add("is-active");
        const target = tab.dataset.target;
        groups.forEach((g) => g.classList.toggle("is-hidden", g.id !== target));
      });
    });
  })();

  // Lightbox
  (function () {
    const modal = document.createElement("div");
    modal.className = "modal";
    modal.innerHTML = `
      <div class="modal-background"></div>
      <div class="modal-content">
        <figure class="image"><img id="gallery-modal-img" alt="Preview" /></figure>
      </div>
      <button class="modal-close is-large" aria-label="close"></button>
    `;
    document.body.appendChild(modal);

    const open = (src) => {
      document.getElementById("gallery-modal-img").src = src;
      modal.classList.add("is-active");
    };
    const close = () => modal.classList.remove("is-active");
    modal.querySelector(".modal-background").addEventListener("click", close);
    modal.querySelector(".modal-close").addEventListener("click", close);
    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") close();
    });

    document.querySelectorAll(".gallery-card").forEach((card) => {
      card.addEventListener("click", () => open(card.dataset.imgSrc));
    });
  })();
</script>

{% endblock %}
